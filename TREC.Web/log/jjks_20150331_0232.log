2015-03-31 14:32:51,484 [8] TREC.Web.Global DEBUG - 家具快搜启动
2015-03-31 14:37:48,752 [8] TREC.Web.Global ERROR - 错误:
UrlReferrer:
http://192.168.1.115:84/productlisttbb.aspx
UserAgent:
Mozilla/5.0 (Windows NT 6.1; WOW64; rv:36.0) Gecko/20100101 Firefox/36.0
UserHostName:
192.168.1.115
UserHostAddress:
192.168.1.115

System.Data.SqlClient.SqlException: 无法绑定由多个部分组成的标识符 "tpb.ProductAttributePromotion"。
无法绑定由多个部分组成的标识符 "tpb.ProductAttributePromotion"。
SELECT *
,  (SELECT TOP 1 tpb.ProductAttributePromotion FROM  t_productattribute tpb WHERE tpb.productid=T.tpid ORDER BY tpb.saleprice) AS ProductAttributePromotion
,  (SELECT TOP 1 tpb.buyprice FROM  t_productattribute tpb WHERE tpb.productid=T.tpid ORDER BY tpb.saleprice) AS buyprice
,  (SELECT TOP 1 tpb.markprice FROM  t_productattribute tpb WHERE tpb.productid=T.tpid ORDER BY tpb.saleprice) AS markprice
,  (SELECT TOP 1 tpb.saleprice FROM  t_productattribute tpb WHERE tpb.productid=T.tpid ORDER BY tpb.saleprice) AS saleprice
 FROM
(SELECT row_number() OVER (ORDER BY (tp.lastedittime) desc) AS rownum,
  isnull(t_shop.id,0) as shopid, isnull(t_shop.title,'' ) as shoptitle ,tp.id AS tpid,tp.title AS tptitle,
tp.companyid,companyname,brandtitle,    tp.sku, tp.stylename, tp.materialname,tp.categorytitle  ,  tp.brandid,tp.thumb,tp.lastedittime  FROM 
dbo.t_product tp
inner join t_brand on t_brand.id = tp.brandid  AND t_brand.auditstatus=1 AND t_brand.linestatus=1 
LEFT JOIN t_productshopprice ON t_productshopprice.productid =  tp.id 
LEFT JOIN dbo.t_shop ON dbo.t_shop.id = t_productshopprice.shopid  
WHERE tp.auditstatus =1 AND tp.linestatus =1  and tpb.ProductAttributePromotion = 3  and tp.categoryid in (SELECT id  FROM dbo.t_productcategory WHERE parentid = 7 AND ptype<>2 ) ) AS T WHERE rownum BETWEEN (1 - 1) * 40 + 1 AND 1 * 40
   在 System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection)
   在 System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj)
   在 System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj)
   在 System.Data.SqlClient.SqlDataReader.ConsumeMetaData()
   在 System.Data.SqlClient.SqlDataReader.get_MetaData()
   在 System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   在 System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async)
   在 System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result)
   在 System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   在 System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)
   在 System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior)
   在 System.Data.Common.DbCommand.System.Data.IDbCommand.ExecuteReader(CommandBehavior behavior)
   在 System.Data.Common.DbDataAdapter.FillInternal(DataSet dataset, DataTable[] datatables, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   在 System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   在 System.Data.Common.DbDataAdapter.Fill(DataSet dataSet)
   在 Haojibiz.Data.SqlHelper.ExecuteDataSet(SqlConnection connection, CommandType cmdType, String cmdText, SqlParameter[] commandParameters)
   在 Haojibiz.Data.SqlHelper.ExecuteDataSet(String connectionString, CommandType cmdType, String cmdText, SqlParameter[] commandParameters)
   在 Haojibiz.Data.SqlHelper.ExecuteDataSet(CommandType cmdType, String cmdText, SqlParameter[] commandParameters)
   在 TREC.Web.ajax.hdsearch.Searchproducttbb(HttpContext context) 位置 F:\CodeNew\trunk\TREC.Web\ajax\hdsearch.ashx.cs:行号 294
   在 TREC.Web.ajax.hdsearch.ProcessRequest(HttpContext context) 位置 F:\CodeNew\trunk\TREC.Web\ajax\hdsearch.ashx.cs:行号 49
   在 System.Web.HttpApplication.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute()
   在 System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean& completedSynchronously)
2015-03-31 14:58:35,459 [8] TREC.Web.Global DEBUG - 家具快搜停止
